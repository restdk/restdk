{"version":3,"file":"core.cjs.js","sources":["../src/core/BaseNode.ts","../../shared/lib/shared.esm.js","../src/core/Restdk.ts","../src/core/ApiArgument.ts","../src/core/Decorator.ts","../src/core/DefGeneric.ts","../src/core/Property.ts","../src/core/Schema.ts","../src/core/Type.ts","../src/core/Value.ts","../src/core/Module.ts","../src/core/Api.ts"],"sourcesContent":["export class BaseNode {\n  nodeType?: string;\n  text?: string; // 代码字符\n  locPath?: string; // 代码块位置 语法 文件路径:行,列\n\n  constructor() {\n    this.nodeType = this.constructor.name;\n  }\n}\n","function make(instance, props) {\r\n    for (const key in props) {\r\n        if (Object.prototype.hasOwnProperty.call(props, key)) {\r\n            const prop = props[key];\r\n            instance[key] = prop;\r\n        }\r\n    }\r\n    return instance;\r\n}\r\nfunction makePlus(constructorFn, props) {\r\n    return make(new constructorFn(), props);\r\n}\n\nfunction toSmallHump(name) {\r\n    const [c, ...other] = name;\r\n    return c.toLowerCase() + other.join(\"\");\r\n}\r\nfunction em(params, prefix = \"\", suffix = \"\") {\r\n    if (typeof params === \"number\" || typeof params === \"boolean\") {\r\n        return params;\r\n    }\r\n    return params ? prefix + params + suffix : \"\";\r\n}\n\nexport { em, make, makePlus, toSmallHump };\n//# sourceMappingURL=shared.esm.js.map\n","import { BaseNode } from \"./BaseNode\";\nimport { em, toSmallHump } from \"@restdk/shared\";\nimport { Module } from \"./Module\";\n\nexport class Restdk extends BaseNode {\n  name: string = \"defaultRestdk\";\n  comment: string; // 注释\n  version: number; // 版本\n  modules: Module[]; // 模块\n\n  schemaString(): string {\n    return this.modules.map((item) => em(item.schemas.join(\"\\n\"))).join(\"\\n\");\n  }\n\n  toString() {\n    return `\n/**\n * name: ${this.name}\n * version: ${this.version}\n * restdkVersion: ${1}\n */\n\n${em(this.schemaString())}\n\n${em(this.modules?.join(\"\\n\"))}\n\nexport function ${this.name}(request){\n  return {\n    ${this.modules.map(\n      (item) => `${toSmallHump(item.name)}: new ${item.name}(request)`\n    )}\n  }\n}\n`;\n  }\n}\n","import { BaseNode } from \"./BaseNode\";\nimport { Type } from \"./Type\";\nimport { em } from \"@restdk/shared\";\n\nexport enum ParamType {\n  QUERY = \"query\",\n  BODY = \"body\",\n  PARAM = \"param\",\n}\n\nexport class ApiArgument extends BaseNode {\n  name: string;\n  paramType: ParamType; // 参数类型\n  defaultValue: string;\n  type: Type; // 类型\n\n  toString() {\n    return `${this.name}${em(this.type, \":\")}`;\n  }\n}\n","import { BaseNode } from \"./BaseNode\";\nimport { DecoratorArgument } from \"./DecoratorArgument\";\n\nexport class Decorator extends BaseNode {\n  name: string;\n  arguments?: DecoratorArgument[] | null;\n\n  getArgumentsString() {\n    if (this.arguments === null || this.arguments === undefined) {\n      return \"\";\n    }\n    return `(${this.arguments.join(\",\")})`;\n  }\n\n  toString() {\n    return `@${this.name}(${this.getArgumentsString()})`;\n  }\n}\n","import { BaseNode } from \"./BaseNode\";\nimport { Type } from \"./Type\";\nimport { em } from \"@restdk/shared\";\n\nexport class DefGeneric extends BaseNode {\n  name: string;\n  extends?: Type; // 继承\n  defaultType?: Type; // 默认值\n\n  getExtendsString() {\n    return this.extends ? `extends ${this.extends}` : \"\";\n  }\n\n  getDefaultTypeString() {\n    return this.defaultType ? ` = ${this.defaultType}` : \"\";\n  }\n\n  toString() {\n    return `${this.name}${em(\n      this.getExtendsString(),\n      \" \"\n    )}${this.getDefaultTypeString()}`;\n  }\n}\n","import { BaseNode } from \"./BaseNode\";\nimport { Type } from \"./Type\";\nimport { em } from \"@restdk/shared\";\nimport { Value } from \"./Value\";\nimport { Decorator } from \"./Decorator\";\n\nexport class Property extends BaseNode {\n  name: string;\n  type: Type;\n  comment?: string;\n  decorators?: Decorator[]; // 属性的装饰器\n  defaultValue?: Value; // 属性默认值\n\n  getDefaultValueString() {\n    if (this.defaultValue) {\n      return `=${this.defaultValue}`;\n    }\n    return \"\";\n  }\n\n  toString() {\n    return `\n    ${em(this.decorators?.join(\"\\n\"))}${em(this.comment, \"\\n\")}\n    ${this.name}:${this.type}${this.getDefaultValueString()}`;\n  }\n}\n","import { BaseNode } from \"./BaseNode\";\nimport { Type } from \"./Type\";\nimport { em } from \"@restdk/shared\";\nimport { DefGeneric } from \"./DefGeneric\";\nimport { Property } from \"./Property\";\n\nexport class Schema extends BaseNode {\n  name: string;\n  comment?: string;\n  extends?: Type; // 继承\n  defGeneric?: DefGeneric[]; // 定义泛型\n  properties: Property[]; // 属性\n\n  getExtendsString() {\n    return this.extends ? `extends ${this.extends}` : \"\";\n  }\n\n  getPropGenericString() {\n    if (!this.defGeneric?.length) {\n      return \"\";\n    }\n    return `<${this.defGeneric?.join(\",\") ?? \"\"}>`;\n  }\n\n  toString() {\n    return `${em(this.comment)}\nexport class ${\n      this.name\n    }${this.getPropGenericString()} ${this.getExtendsString()} {\n  ${em(this.properties?.join(\"\\n\"))}\n}`;\n  }\n}\n","import { BaseNode } from \"./BaseNode\";\n\nexport class Type extends BaseNode {\n  name: string;\n  propGeneric?: Type[]; // 泛型传参\n\n  private getPropGenericString() {\n    if (!this.propGeneric?.length) {\n      return \"\";\n    }\n    return `<${this.propGeneric?.join(\",\") ?? \"\"}>`;\n  }\n\n  toString() {\n    return `${this.name}${this.getPropGenericString()}`;\n  }\n}\n","import { BaseNode } from \"./BaseNode\";\nimport { Type } from \"./Type\";\n\nexport class Value extends BaseNode {\n  type?: Type;\n  toString() {\n    return this.text;\n  }\n}\n","import { BaseNode } from \"./BaseNode\";\nimport { em } from \"@restdk/shared\";\nimport { Schema } from \"./Schema\";\nimport { Api } from \"./Api\";\n\nexport class Module extends BaseNode {\n  name: string;\n  comment: string;\n  parent: string; // 父模块名字\n  apis: Api[]; // 接口方法\n  schemas: Schema[]; // 模型\n\n  toString() {\n    return `\n${em(this.comment)}\nexport class ${this.name} extends Api{\n  constructor(private request) {\n    super();\n    ${this.parent ? `this.parent = new ${this.parent}(request);` : \"\"}\n  }\n\n${em(this.apis?.join(\"\\n\"))}\n}\n    `;\n  }\n}\n","import { em } from \"@restdk/shared\";\nimport { BaseNode } from \"./BaseNode\";\nimport { ApiThrow } from \"./ApiThrow\";\nimport { ApiResult } from \"./ApiResult\";\nimport { ApiArgument } from \"./ApiArgument\";\n\nexport enum ApiMethod {\n  GET = \"Get\",\n  POST = \"Post\",\n  DEL = \"Delete\",\n  PATCH = \"Patch\",\n  PUT = \"Put\",\n}\n\nexport class Api extends BaseNode {\n  name: string;\n  comment: string;\n  method: ApiMethod; // 请求类型 GET POST ...\n  arguments: ApiArgument[]; // 请求参数\n  results: ApiResult[]; // 返回结果\n  throws: ApiThrow[]; // 抛错\n\n  getParamMap() {\n    const paramMap = {\n      param: [],\n      query: [],\n      body: [],\n    };\n\n    for (let i = 0; i < this.arguments.length; i++) {\n      const argument = this.arguments[i];\n      paramMap[argument.paramType].push(argument.name);\n    }\n\n    return paramMap;\n  }\n\n  toString() {\n    const { param = [], query = [], body = [] } = this.getParamMap();\n    return `\n    ${em(this.comment)}\n    ${this.name}(${em(this.arguments?.join(\", \"))}):Promise<${\n      em(this.results?.join(\"|\")) || \"any\"\n    }>{\n      return this.request({\n        method: \"${this.method}\",\n        url: this.getUrl(),\n        param: {${param.join(\",\")}},\n        query: ${query.join(\",\")},\n        body: ${body.join(\",\")},\n      })\n    }\n    `;\n  }\n}\n"],"names":["ParamType","ApiMethod"],"mappings":"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"}